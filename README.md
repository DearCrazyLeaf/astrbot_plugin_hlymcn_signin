# HLYM Server Toolkit (AstrBot Plugin)

### ğŸ’¬ ç¾¤èŠç­¾åˆ° + ğŸ® æœåŠ¡å™¨æŸ¥è¯¢ï¼ˆA2S/åç«¯ APIï¼‰+ ğŸ“Š æ•°æ®æŸ¥è¯¢ + ğŸ› ï¸ RCON

![Python](https://img.shields.io/badge/Python-3.10%2B-blue)
![AstrBot](https://img.shields.io/badge/AstrBot-v4.12%2B-brightgreen)
![License](https://img.shields.io/badge/License-GPL--3.0-orange)

![views](https://count.getloli.com/get/@astrbotchuanhuatong?theme=booru-jaypee)

---

## ğŸ§© æ’ä»¶å®šä½

è¿™æ˜¯ä¸€ä¸ªé¢å‘ QQ ç¾¤åœºæ™¯çš„æœåŠ¡å™¨å·¥å…·æ’ä»¶ï¼Œæ”¯æŒï¼š
- âœ… ç¾¤èŠç­¾åˆ°
- âœ… æŸ¥æœï¼ˆåç«¯ API æˆ– A2S ç›´è¿ï¼‰
- âœ… ç©å®¶æ•°æ®æŸ¥è¯¢
- âœ… RCON è¿œç¨‹æŒ‡ä»¤
- âœ… å›¾ç‰‡å¡ç‰‡æ¸²æŸ“

---

## âš ï¸ é‡è¦è¯´æ˜ï¼ˆè¯·å…ˆçœ‹ï¼‰

> [!IMPORTANT]
> æœ¬æ’ä»¶é«˜åº¦ä¾èµ–åç«¯ã€‚  
> æœ¬ä»“åº“åªæä¾› AstrBot æ’ä»¶ï¼Œä¸æä¾›åç«¯æœåŠ¡å®ç°ã€‚

å¦‚æœä½ æ²¡æœ‰è‡ªå»ºåç«¯ï¼Œé€šå¸¸åªèƒ½ä½¿ç”¨â€œåŸºç¡€æŸ¥æœï¼ˆA2S ç›´è¿ï¼‰â€è¿™ç±»æµ…å±‚åŠŸèƒ½ã€‚  
ç­¾åˆ°ã€æ•°æ®æŸ¥è¯¢ã€RCONã€åœ°å›¾å°é¢èƒŒæ™¯ç­‰æ ¸å¿ƒèƒ½åŠ›éƒ½éœ€è¦ä½ è‡ªå·±çš„åç«¯æ¥å£æ”¯æŒã€‚

---

## ğŸ“Œ åŠŸèƒ½ä¾èµ–çŸ©é˜µ

| åŠŸèƒ½ | æ— åç«¯å¯ç”¨ | éœ€è¦åç«¯ | è¯´æ˜ |
|------|------------|----------|------|
| æŸ¥æœï¼ˆA2Sç›´è¿ï¼‰ | æ˜¯ | å¦ | é…ç½® `servers` å³å¯ï¼Œæ¥å£å¤±è´¥å¯å›é€€ A2S |
| æŸ¥æœï¼ˆåç«¯APIï¼‰ | å¦ | æ˜¯ | éœ€è¦ `server_status_api_base_url + server_status_api_path` |
| æŸ¥æœèƒŒæ™¯ `header` | æ˜¯ | å¦ | ä½¿ç”¨æ’ä»¶å¤´å›¾ç¼“å­˜ |
| æŸ¥æœèƒŒæ™¯ `map_cover` | å¦ | æ˜¯ | éœ€è¦åç«¯è¿”å› `mapImage/map_image/basic_info.map_image` |
| ç­¾åˆ° | å¦ | æ˜¯ | éœ€è¦ç­¾åˆ°æ¥å£ |
| æ•°æ®æŸ¥è¯¢ | å¦ | æ˜¯ | éœ€è¦ QQ æ•°æ®æŸ¥è¯¢æ¥å£ |
| RCON | å¦ | æ˜¯ | éœ€è¦ RCON åç«¯ API |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸŸ¢ æ–¹æ¡ˆ Aï¼šä»…ä½¿ç”¨åŸºç¡€æŸ¥æœï¼ˆæ— éœ€åç«¯ï¼‰

æœ€å°é…ç½®å»ºè®®ï¼š
- `allowed_group_ids`ï¼šå…è®¸è§¦å‘åŠŸèƒ½çš„ç¾¤å·
- `servers`ï¼šæœåŠ¡å™¨åˆ«ååˆ—è¡¨ï¼ˆ`åˆ«å=ip:port`ï¼‰
- `a2s_render_mode`ï¼š`card` / `image_text` / `text`
- `server_status_api_base_url`ï¼šç•™ç©ºï¼ˆè®©æ’ä»¶èµ° A2S ç›´è¿ï¼‰
- `server_query_bg_mode`ï¼šå»ºè®® `header`
- `header_image_url`ï¼šå¯é€‰ï¼Œæä¾›æŸ¥æœèƒŒæ™¯å›¾

å¯ç”¨å‘½ä»¤ï¼š
- å‘é€æœåŠ¡å™¨åˆ«åï¼ˆä¾‹å¦‚ `cs`ï¼‰è§¦å‘æŸ¥æœ
- å‘é€ `ip` æŸ¥çœ‹å·²é…ç½®æœåŠ¡å™¨åˆ«ååˆ—è¡¨

### ğŸ”µ æ–¹æ¡ˆ Bï¼šä½¿ç”¨å®Œæ•´åŠŸèƒ½ï¼ˆéœ€è¦è‡ªå»ºåç«¯ï¼‰

é™¤æ–¹æ¡ˆ A å¤–ï¼Œè¿˜éœ€é…ç½®ï¼š
- `base_url`
- `signin_path`
- `stats_path`
- `server_status_api_base_url`
- `server_status_api_path`
- `rcon_api_base_url`
- `rcon_password`
- `rcon_admin_ids`

---

## âš™ï¸ é…ç½®è¯´æ˜ï¼ˆæŒ‰æ¨¡å—ï¼‰

æ’ä»¶é…ç½®å…¥å£ï¼š  
`AstrBot WebUI -> æ’ä»¶ -> astrbot_plugin_hlymcn_signin`

### ğŸŒ 1. åç«¯åŸºç¡€é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `base_url` | åç«¯åŸºç¡€åœ°å€ï¼ˆç­¾åˆ° / æ•°æ®æŸ¥è¯¢é»˜è®¤åŸºäºæ­¤ï¼‰ |
| `timeout_ms` | HTTP è¶…æ—¶æ¯«ç§’ |
| `signin_path` | ç­¾åˆ°æ¥å£è·¯å¾„ |
| `stats_path` | æ•°æ®æŸ¥è¯¢æ¥å£è·¯å¾„ |

### ğŸ‘¥ 2. ç¾¤èŠè§¦å‘æ§åˆ¶

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `allowed_group_ids` | å…è®¸ç”Ÿæ•ˆçš„ç¾¤å·åˆ—è¡¨ |
| `strict_single_plain` | æ˜¯å¦åªå…è®¸çº¯æ–‡æœ¬æ¶ˆæ¯è§¦å‘ |
| `stats_keywords` | æ•°æ®æŸ¥è¯¢è§¦å‘è¯ï¼ˆæ”¯æŒå¤šä¸ªï¼‰ |

### ğŸ–¥ï¸ 3. æŸ¥æœé…ç½®

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `servers` | æœåŠ¡å™¨åˆ«ååˆ—è¡¨ï¼ˆ`åˆ«å=ip:port`ï¼‰ |
| `players_limit` | ç©å®¶åˆ—è¡¨æ˜¾ç¤ºä¸Šé™ |
| `a2s_render_mode` | æŸ¥æœè¾“å‡ºæ¨¡å¼ï¼š`card` / `image_text` / `text` |
| `server_status_api_base_url` | æŸ¥æœ API åŸºç¡€åœ°å€ï¼ˆç•™ç©ºé»˜è®¤å°è¯•ç”¨ `base_url`ï¼‰ |
| `server_status_api_path` | æŸ¥æœ API è·¯å¾„ |
| `server_status_api_timeout_ms` | æŸ¥æœ API è¶…æ—¶ |
| `server_status_api_fallback` | API å¤±è´¥æ—¶æ˜¯å¦å›é€€ A2S ç›´è¿ |
| `a2s_timeout_ms` | A2S è¶…æ—¶ |
| `server_official_site` | é»˜è®¤å®˜ç½‘å­—æ®µæ˜¾ç¤º |
| `server_official_sites` | æœåŠ¡å™¨ä¸“å±å®˜ç½‘ï¼ˆ`åˆ«å=å®˜ç½‘`ï¼‰ |

### ğŸ–¼ï¸ 4. æŸ¥æœèƒŒæ™¯æ¨¡å¼

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `server_query_bg_mode` | `header` æˆ– `map_cover` |

æ¨¡å¼è¡Œä¸ºï¼š
- `header`ï¼šå§‹ç»ˆä½¿ç”¨æ’ä»¶è‡ªå®šä¹‰å¤´å›¾ç¼“å­˜
- `map_cover`ï¼šä¼˜å…ˆä½¿ç”¨åç«¯è¿”å›åœ°å›¾å°é¢ï¼›ä¸å¯ç”¨æ—¶è‡ªåŠ¨å›é€€ `header`

> [!IMPORTANT]
> `map_cover` éœ€è¦åç«¯æŸ¥æœ API è¿”å›åœ°å›¾å›¾å­—æ®µä¹‹ä¸€ï¼š  
> `mapImage` / `map_image` / `basic_info.map_image`  
> è‹¥åç«¯ä¸è¿”å›ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨å›é€€å¤´å›¾æ¨¡å¼ã€‚

### ğŸ—‚ï¸ 5. å¤´å›¾ç¼“å­˜é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `header_image_url` | å¤´å›¾é“¾æ¥ï¼ˆå¤šæ¡å¯ç”¨æ¢è¡Œ/é€—å·/åˆ†å·åˆ†éš”ï¼‰ |
| `header_prefetch_count` | `prefetch_header` å‘½ä»¤é¢„è½½æ•°é‡ |
| `header_cache_limit` | å¤´å›¾ç¼“å­˜ä¸Šé™ |
| `header_image_max_bytes` | å•å¼ å¤´å›¾ä¸‹è½½æœ€å¤§å­—èŠ‚ |

### ğŸ” 6. RCON é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `rcon_api_base_url` | RCON API åŸºç¡€åœ°å€ |
| `rcon_password` | RCON å¯†ç  |
| `rcon_command_prefix` | RCON æŒ‡ä»¤å‰ç¼€ï¼ˆé»˜è®¤ `rcon`ï¼‰ |
| `rcon_timeout_ms` | RCON è¶…æ—¶ |
| `rcon_admin_ids` | å…è®¸æ‰§è¡Œ RCON çš„ç®¡ç†å‘˜ QQ åˆ—è¡¨ï¼ˆä¸ºç©ºåˆ™ç¦ç”¨ï¼‰ |

### ğŸ 7. è°ƒè¯•é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `debug_log` | è¾“å‡ºè°ƒè¯•æ—¥å¿—åˆ°æ§åˆ¶å° |

---

## âŒ¨ï¸ å‘½ä»¤ä¸è§¦å‘è¯

### âœï¸ ç­¾åˆ°
```text
ç­¾åˆ°
```

### ğŸ” æŸ¥æœ
```text
cs
```

### ğŸ“„ æŸ¥çœ‹æœåŠ¡å™¨åˆ«ååˆ—è¡¨
```text
ip
```

### ğŸ“Š æ•°æ®æŸ¥è¯¢
```text
data
stat
æˆ‘çš„æ•°æ®
æŸ¥è¯¢æ•°æ®
```

### ğŸ› ï¸ RCON
```text
rcon <åˆ«å> <å‘½ä»¤>
```
ç¤ºä¾‹ï¼š
```text
rcon cs status
```

### ğŸ§° é¢„è½½å¤´å›¾ç¼“å­˜
```text
prefetch_header
```

---

## ğŸ”Œ åç«¯æ¥å£å¥‘çº¦ï¼ˆæœ€ä½è¦æ±‚ï¼‰

### 1. ç­¾åˆ°æ¥å£ï¼ˆ`signin_path`ï¼‰

- è¯·æ±‚ï¼š`GET`
- å…³é”®å‚æ•°ï¼š`userId`ã€`deviceType`ã€`signinType`
- è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "message": "ç­¾åˆ°æˆåŠŸ"
}
```

### 2. æ•°æ®æŸ¥è¯¢æ¥å£ï¼ˆ`stats_path/{qq}`ï¼‰

- è¯·æ±‚ï¼š`GET`
- è¿”å›ç¤ºä¾‹ï¼ˆæœ€å°‘å­—æ®µï¼‰ï¼š
```json
{
  "success": true,
  "data": {
    "steamId64": "7656xxxxxxxxxxxxxx",
    "credits": 123,
    "playTime": {
      "playerName": "Player"
    },
    "stats": {
      "kills": 0,
      "deaths": 0
    }
  }
}
```

### 3. æŸ¥æœæ¥å£ï¼ˆ`server_status_api_path`ï¼‰

- è¯·æ±‚ï¼š`GET`
- å‚æ•°ï¼š`servers=ip:port`
- è¿”å›ç¤ºä¾‹ï¼ˆæœ€å°‘å­—æ®µï¼‰ï¼š
```json
{
  "servers": [
    {
      "name": "Server Name",
      "map": "de_dust2",
      "mapImage": "https://example.com/cover.jpg",
      "raw": {
        "playerCount": 10,
        "maxPlayers": 32,
        "botCount": 0,
        "game": "Counter-Strike 2"
      },
      "query": {
        "ping": 35
      },
      "players": []
    }
  ]
}
```

### 4. RCON æ¥å£ï¼ˆå›ºå®š `${rcon_api_base_url}/rcon`ï¼‰

- è¯·æ±‚ï¼š`POST`
- è¯·æ±‚ä½“ï¼š
```json
{
  "ip": "1.2.3.4:27015",
  "cmd": "status",
  "passwd": "your-password"
}
```

---

## ğŸ§­ å¸¸è§é…ç½®ç›²åŒº

1. é…äº† `map_cover` ä½†èƒŒæ™¯ä¸ç”Ÿæ•ˆ  
åç«¯æ²¡è¿”å›åœ°å›¾å°é¢å­—æ®µï¼Œæ’ä»¶ä¼šè‡ªåŠ¨å›é€€å¤´å›¾ã€‚

2. é…äº† `servers` ä½†æŸ¥æœå¤±è´¥  
è¯·æ£€æŸ¥æœåŠ¡å™¨åœ°å€æ ¼å¼æ˜¯å¦ä¸º `ip:port`ï¼Œå¹¶ç¡®è®¤ `allowed_group_ids` åŒ…å«å½“å‰ç¾¤ã€‚

3. èƒ½æŸ¥æœä½†ç­¾åˆ°/æŸ¥æ•°æ®å¤±è´¥  
è¯´æ˜åç«¯å¯¹åº”æ¥å£æœªå®ç°æˆ–è·¯å¾„ä¸åŒ¹é…ï¼›æŸ¥æœ A2S å¯ç‹¬ç«‹å·¥ä½œï¼Œä¸ä»£è¡¨å…¶å®ƒæ¥å£å¯ç”¨ã€‚

4. RCON æ²¡ååº”  
æ£€æŸ¥ `rcon_admin_ids` æ˜¯å¦åŒ…å«ä½ çš„ QQï¼Œä¸” `rcon_api_base_url` ä¸ `rcon_password` æ­£ç¡®ã€‚

---

## ğŸ“„ License

GPL-3.0

---

> Made for AstrBot â¤ï¸
